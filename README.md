# simpath.rb

## お姉さん問題 a.k.a. s-t path 問題

「狂気を感じる...」と注目を浴びたあの [数え上げお姉さん動画][] ですが、  
私もお姉さん問題を効率的に解くプログラムを作ってみました。

お姉さん問題はかっこよく言えば「グリッドグラフに対する s-t path 問題」となります。  
グリッドグラフとは n × n の格子グラフです。  
s-t path 問題とはグラフ中に s-t path がいくつあるか答える問題です。  
s-t path とは同じノードを複数回含まない s から t への経路のことです。

お姉さんはこれを深さ優先探索で数え上げています。  
しかし、動画にあるように、この方法はやばい遅いです。

そこでこの問題を効率的に解く 「simpath algorithm」を実装し、
このアルゴリズムが如何に素晴らしいか体感しみることにします。

[数え上げお姉さん動画]: http://www.youtube.com/watch?v=Q4gTV4r0zRs



## simpath algorithm

ざっくりアルゴリズムのアイディアを述べるのであれば、

「共通パスをできるだけまとめ上げる」

です。実際に３×３の s-t path 問題を解いてみると分かると思いますが、い
くつかの s-t path は共通の部分パスを持ちます。この共通部分を発見するた
めに simpath algorithm では「mate 配列」と「フロンティア」というアイディ
アを導入します。

mate 配列とは（作りかけの）パスの"状態"を表します。そしてこの"状態"とは
とても素敵で、 「mate 配列の値が一致すれば、その後の展開も一致する」 と
いう性質を持ちます。つまりパスの展開中に過去と同じ mate 配列の値が現れ
れば、そこはもはや展開する必要がないのです！このように mate 配列の値を
記憶しておくことでパスの再展開を回避でき、効率的に s-t path を数えられ
るのです。

フロンティアとは mate 配列のうち、今気にするべき領域です。mate 配列は現
在の展開の状態を表しますが、探索をしていくうちに mate 配列はもはや参考
にする必要がのない部分を持ちます。フロンティアとは今現在、気にするべき
領域であり、逆にフロンティアの状態を表しているのが mate 配列といっても
いいです。

このフロンティアと mate 配列を利用することで効率よく s-t path を数えら
れるのです。

アルゴリズムの詳細は参考文献を参照してください。  

## 参考文献
メディアラボ ［未来をつくる］ 常設展示｜日本科学未来館
http://www.miraikan.jst.go.jp/sp/exhibition/medialabo.html

JST ERATO 湊離散構造処理系プロジェクト
http://www-erato.ist.hokudai.ac.jp/html/php/sub_html.php?id=19


## 実行してみる

試しに 8 × 8 のグリッドグラフに対する s-t path 問題を解いています。

    time ruby simpath.rb -n 8

すると以下のような結果となりました。

    n = 8
    e = 112
    depth = 0 / 112: 1 nodes
    depth = 1 / 112: 2 nodes
    depth = 2 / 112: 2 nodes
    depth = 3 / 112: 4 nodes
    depth = 4 / 112: 4 nodes
    depth = 5 / 112: 8 nodes
    ...
    depth = 110 / 112: 4 nodes
    depth = 111 / 112: 3 nodes
    789360053252 paths

    real	0m17.021s
    user	0m16.310s
    sys	0m0.246s

正しく数え上げられていますね。  


ほんとかよ！と思う人は以下のページで確かめてください。このページは整数
列の一部を入れると、その数列がどんなものか教えてくれるものです。  （す
ごいね！）ここにプログラムの 2 ~ 5 の出力を入れればちゃんとグリッドグラ
フに対する s-t path の数だと出てくるはずです。

オンライン整数列大辞典
http://oeis.org/?language=japanese

